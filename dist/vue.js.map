{"version":3,"file":"vue.js","sources":["../src/compiler/index.js","../src/observe/Array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["//<div id=\"app\">{{name}}</div>\r\nconst ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`; //标签名\r\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`; //获取标签名 div  template.match(new RegExp(qnameCapture)\r\nconst startTagOpen = new RegExp(`^<${qnameCapture}`); // 匹配开始标签\r\nconst startTagClose = /^\\s*(\\/?)>/;\r\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`); //  </\r\nconst attribute =\r\n  /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/; // 属性 id=\"app\"\r\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g; //{{name}}\r\n// html字符串  解析成dom树\r\n// vue 是用的正则匹配 (应该逐词解析)\r\nexport function compileToFunctions(template) {\r\n  parseHTML(template);\r\n}\r\nfunction parseHTML(html) {\r\n  let index = 0;\r\n  function start(tagName, attributes) {}\r\n  function end(tagName) {\r\n    console.log(\"-->\", text);\r\n  }\r\n  function chars(tagname) {}\r\n\r\n  while (html) {\r\n    let textEnd = html.indexOf(\"<\");\r\n    if (textEnd === 0) {\r\n      const startTagMatch = parseStartTag();\r\n      console.log(startTagMatch, \"startTagMatch\");\r\n      return;\r\n    }\r\n  }\r\n  function parseStartTag() {\r\n    const start = html.match(startTagOpen);\r\n    // console.log(start, \"html\");    (2) [\"<div\", \"div\", index: 0, input: \"<div id=\\\"app\\\">{{name}}</div>\", groups: undefined]0: \"<div\"1: \"div\"groups: undefinedindex: 0input: \"<div id=\\\"app\\\">{{name}}</div>\"length: 2__proto__: Array(0) \"html\"\r\n    if (start) {\r\n      const match = {\r\n        tagName: start[1],\r\n        attrs: [],\r\n        start: index,\r\n      };\r\n      advance(start[0].length);\r\n      let end, attr;\r\n      while (\r\n        !(end = html.match(startTagClose)) &&\r\n        (attr = html.match(attribute))\r\n      ) {\r\n        attr.start = index;\r\n        // console.log(attr, \"attr\");  [\" id=\\\"app\\\"\", \"id\", \"=\", \"app\", undefined, undefined, index: 0, input: \" id=\\\"app\\\">{{name}}</div>\", groups: undefined, start: 4]0: \" id=\\\"app\\\"\"1: \"id\"2: \"=\"3: \"app\"4: undefined5: undefinedend: 13groups: undefinedindex: 0input: \" id=\\\"app\\\">{{name}}</div>\"start: 4length: 6__proto__: Array(0) \"attr\"\r\n        advance(attr[0].length);\r\n        attr.end = index;\r\n        match.attrs.push({\r\n          name: attr[1],\r\n          value: attr[3] || attr[4] || attr[5] || \"\",\r\n        });\r\n      }\r\n      if (end) {\r\n        advance(end[0].length);\r\n      }\r\n      console.log(match, \"match\");\r\n      // console.log(html, \"html\");     >{{name}}</div> html\r\n      return match;\r\n    }\r\n  }\r\n  function advance(n) {\r\n    console.log(n, \"n\");\r\n    index += n;\r\n    html = html.substring(n);\r\n  }\r\n}\r\n","const oldArrayProto = Array.prototype;\r\nexport const arrayMethods = Object.create(oldArrayProto);\r\nconst methods = [\r\n  \"push\",\r\n  \"pop\",\r\n  \"shift\",\r\n  \"unshift\",\r\n  \"splice\",\r\n  \"sort\",\r\n  \"reverse\",\r\n];\r\nmethods.forEach((method) => {\r\n  arrayMethods[method] = function (...args) {\r\n    console.log(\"数组发生变化了\");\r\n    const ob = this.__ob__;\r\n    const result = oldArrayProto[method].call(this, ...args);\r\n    let inserted;\r\n    switch (method) {\r\n      case \"push\":\r\n      case \"unshift\":\r\n        inserted = args;\r\n        break;\r\n      case \"splice\":\r\n        inserted = args.slice(2);\r\n        break;\r\n    }\r\n    console.log(inserted, \"inserted\");\r\n    if (inserted) ob.observeArray(inserted);\r\n    return result;\r\n  };\r\n});\r\n","import { arrayMethods } from \"./Array\";\r\n\r\nclass Observer {\r\n  constructor(data) {\r\n    //对对象所有的属性进行劫持\r\n    data.__ob__ = this;\r\n    // 数组劫持\r\n    if (Array.isArray(data)) {\r\n      data.__proto__ = arrayMethods;\r\n      // 如果数组中的是{}需要监控对象的变化\r\n      this.observeArray(data);\r\n    } else {\r\n      // 对象劫持\r\n      this.walk(data);\r\n    }\r\n  }\r\n  /**\r\n   * Observe a obj 对象\r\n   */\r\n  walk(data) {\r\n    const keys = Object.keys(data);\r\n    for (let i = 0; i < keys.length; i++) {\r\n      defineReactive(data, keys[i], data[keys[i]]);\r\n    }\r\n  }\r\n  /**\r\n   * Observe a list Array items 数组\r\n   */\r\n  observeArray(data) {\r\n    console.log(data, \"observeArray\");\r\n    data.forEach((item) => {\r\n      observe(item);\r\n    });\r\n  }\r\n}\r\nfunction defineReactive(obj, key, value) {\r\n  // 递归观测对象\r\n  if (key == \"__ob__\") return;\r\n  observe(value);\r\n  Object.defineProperty(obj, key, {\r\n    get() {\r\n      console.log(\"defineReactive\", value);\r\n      return value;\r\n    },\r\n    set(newVal) {\r\n      console.log(\"defineReactive\", \"set\", newVal);\r\n      // 如果赋值是{}继续观测\r\n      observe(newVal);\r\n      value = newVal;\r\n    },\r\n  });\r\n}\r\nexport function observe(data) {\r\n  if (typeof data !== \"object\") return;\r\n  if (data.__ob__) return;\r\n  return new Observer(data);\r\n}\r\n","import { observe } from \"./observe/index.js\";\r\n\r\nexport function initState(vm) {\r\n  const opts = vm.$options;\r\n  if (opts.data) {\r\n    initData(vm);\r\n  }\r\n}\r\nfunction initData(vm) {\r\n  let data = vm.$options.data;\r\n  // 函数 取返回值\r\n  data = vm._data = typeof data === \"function\" ? data.call(vm) : data;\r\n  // 代理  能直接使用vm.数据\r\n  const keys = Object.keys(data);\r\n  let i = keys.length;\r\n  while (i--) {\r\n    let key = keys[i];\r\n    proxy(vm, `_data`, key);\r\n  }\r\n  observe(data);\r\n}\r\n// 当取vm.数据   就去取vm._data数据\r\nexport function proxy(vm, sourceKey, key) {\r\n  Object.defineProperty(vm, key, {\r\n    get() {\r\n      return vm[sourceKey][key];\r\n    },\r\n    set(val) {\r\n      vm[sourceKey][key] = val;\r\n    },\r\n  });\r\n}\r\n","import { compileToFunctions } from \"./compiler/index.js\";\r\nimport { initState } from \"./state\";\r\n\r\nexport function initMixin(Vue) {\r\n  Vue.prototype._init = function (options) {\r\n    const vm = this;\r\n    vm.$options = options;\r\n    initState(vm);\r\n    if (options.el) {\r\n      vm.$mount(options.el);\r\n    }\r\n  };\r\n  Vue.prototype.$mount = function (el) {\r\n    const vm = this;\r\n    const options = vm.$options;\r\n    el = document.querySelector(el);\r\n    // vue 1 直接替换用正则直接替换 template\r\n    // 把模板转换成渲染函数=>虚拟dom=>diff算法 => 更新虚拟dom=>产生真实节点更新\r\n    if (!options.render) {\r\n      let template = options.template;\r\n      if (!template && el) {\r\n        template = el.outerHTML;\r\n        compileToFunctions(template);\r\n      }\r\n    }\r\n  };\r\n}\r\n","import { initMixin } from \"./init\";\r\n\r\nfunction Vue(options) {\r\n  this._init(options);\r\n}\r\n\r\ninitMixin(Vue);\r\nexport default Vue;\r\n"],"names":["ncname","qnameCapture","startTagOpen","RegExp","startTagClose","attribute","compileToFunctions","template","parseHTML","html","index","textEnd","indexOf","startTagMatch","parseStartTag","console","log","start","match","tagName","attrs","advance","length","end","attr","push","name","value","n","substring","oldArrayProto","Array","prototype","arrayMethods","Object","create","methods","forEach","method","ob","__ob__","args","result","call","inserted","slice","observeArray","Observer","data","isArray","__proto__","walk","keys","i","defineReactive","item","observe","obj","key","defineProperty","get","set","newVal","initState","vm","opts","$options","initData","_data","proxy","sourceKey","val","initMixin","Vue","_init","options","el","$mount","document","querySelector","render","outerHTML"],"mappings":"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"}